<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³ä¹åº“ - ä¸œæ–¹ProjectåŒäººéŸ³ä¹ç½‘ç«™</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #302363;
            --secondary-color: #df8888;
            --accent-color: #00a6eb;
            --download-color: #C51D1D;
            --background-gradient-start: #120F33;
            --background-gradient-end: #2A235A;
            --text-primary: #333;
            --text-secondary: #666;
            --card-bg: #f0f0f0;
            --sidebar-width: 280px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: #fff;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }

        h1, h2, h3 {
            font-family: 'Noto Serif SC', serif;
        }

        /* å¯¼èˆªæ  */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 3rem;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .logo {
            font-family: 'Noto Serif SC', serif;
            font-size: 2rem;
            color: var(--primary-color);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: #333;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--accent-color);
        }

        .nav-links a.active {
            color: var(--download-color);
            font-weight: bold;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-container {
            display: flex;
            margin-top: 80px;
            min-height: calc(100vh - 140px);
        }

        /* æœç´¢å’Œç­›é€‰åŒºåŸŸ */
        .search-section {
            padding: 2rem 3rem;
            background: #f0f0f0;
            border-radius: 12px;
            margin: 2rem;
        }

        .search-box {
            display: flex;
            margin-bottom: 1.5rem;
        }

        .search-input {
            flex: 1;
            padding: 0.8rem 1rem;
            border: none;
            border-radius: 8px 0 0 8px;
            background: #fff;
            color: #333;
            font-size: 1rem;
        }

        .search-input:focus {
            outline: none;
            background: #fff;
        }

        .search-button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0 1.5rem;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        .search-button:hover {
            background: var(--accent-color);
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            background: #e9e9e9;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tag:hover, .tag.active {
            background: var(--secondary-color);
            color: white;
        }

        /* å·¦ä¾§ç­›é€‰é¢æ¿ */
        .sidebar {
            width: var(--sidebar-width);
            padding: 2rem;
            background: #eee;
            border-radius: 12px;
            margin: 2rem 0 2rem 2rem;
            height: fit-content;
        }

        .filter-group {
            margin-bottom: 2rem;
        }

        .filter-group h3 {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .filter-option {
            display: flex;
            align-items: center;
        }

        .filter-option input {
            margin-right: 0.8rem;
        }

        .filter-option label {
            cursor: pointer;
        }

        /* ä¸­å¤®å†…å®¹åŒºåŸŸ */
        .content-area {
            flex: 1;
            padding: 2rem;
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sort-options {
            display: flex;
            gap: 1rem;
        }

        .sort-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .sort-btn:hover, .sort-btn.active {
            color: var(--download-color);
            background: rgba(255, 255, 255, 0.1);
        }

        /* éŸ³ä¹å¡ç‰‡ç½‘æ ¼ */
        .music-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 2rem;
        }

        .music-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .music-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .album-cover {
            width: 100%;
            height: 200px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .album-cover::before {
            content: '';
            position: absolute;
            top: 0;
            left:0;
            right:0;
            bottom:0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1;
        }
        
        .album-cover .fallback-content {
            position: relative;
            z-index: 2;
            font-size: 4rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .card-content {
            padding: 1.5rem;
        }

        .card-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-artist {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .card-stats {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .play-button {
            background: var(--accent-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: absolute;
            bottom: 10px;
            right: 10px;
            opacity: 0;
        }

        .music-card:hover .play-button {
            opacity: 1;
        }

        .play-button:hover {
            transform: scale(1.1);
            background: var(--download-color);
        }

        /* åˆ†é¡µ */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 3rem;
            gap: 0.5rem;
        }

        /* éšè—åº•éƒ¨æ’­æ”¾å™¨ */
        .player {
            display: none;
        }

        .page-btn {
            background: #eee;
            border: none;
            color: #333;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn:hover, .page-btn.active {
            background: var(--download-color);
            color: white;
        }

        /* ä¸“è¾‘è¯¦æƒ…æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #fff;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .album-art {
            width: 300px;
            height: 300px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            margin: 2rem;
            border-radius: 8px;
            position: relative;
        }
        
        .album-art::before {
            content: '';
            position: absolute;
            top: 0;
            left:0;
            right:0;
            bottom:0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        
        .album-art .fallback-content {
            position: relative;
            z-index: 2;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .album-info {
            flex: 1;
            padding: 2rem 2rem 2rem 0;
            overflow-y: auto;
        }

        .album-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .album-artist {
            color: var(--accent-color);
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .album-meta {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .track-list {
            margin-top: 2rem;
        }

        .track-list h3 {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .tracks {
            list-style: none;
        }

        .track {
            display: flex;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid #eee;
        }

        .track-number {
            width: 30px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .track-title {
            flex: 1;
            padding: 0 1rem;
        }

        .track-duration {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .track-play-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }

        .track-play-btn:hover {
            color: var(--download-color);
            background: #eee;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #eee;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: #333;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .close-modal:hover {
            background: var(--download-color);
            color: white;
        }

        /* åº•éƒ¨éŸ³ä¹æ’­æ”¾å™¨ */
        .player {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #fff;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding: 1rem 2rem;
            display: none;
            align-items: center;
            z-index: 1001;
        }

        .now-playing {
            display: flex;
            align-items: center;
            width: 300px;
        }

        .now-playing-cover {
            width: 50px;
            height: 50px;
            background: var(--secondary-color);
            border-radius: 8px;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .now-playing-info {
            flex: 1;
        }

        .now-playing-title {
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .now-playing-artist {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .player-controls {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .control-buttons {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .control-btn {
            background: none;
            border: none;
            color: #333;
            font-size: 1rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: #eee;
        }

        .control-btn.play-pause {
            width: 50px;
            height: 50px;
            background: var(--secondary-color);
            color: white;
        }

        .control-btn.play-pause:hover {
            background: var(--download-color);
        }

        .progress-container {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
            width: 40px;
        }

        .progress-bar {
            flex: 1;
            height: 5px;
            background: #e9e9e9;
            border-radius: 5px;
            position: relative;
            cursor: pointer;
        }

        .progress {
            height: 100%;
            background: var(--secondary-color);
            border-radius: 5px;
            width: 30%;
        }

        .volume-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: 150px;
        }

        .volume-icon {
            color: var(--text-secondary);
        }

        .volume-slider {
            flex: 1;
            height: 5px;
            background: #e9e9e9;
            border-radius: 5px;
            position: relative;
            cursor: pointer;
        }

        .volume-level {
            height: 100%;
            background: var(--secondary-color);
            border-radius: 5px;
            width: 80%;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: calc(100% - 4rem);
                margin: 2rem;
            }
            
            .music-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }

        @media (max-width: 768px) {
            nav {
                padding: 1rem;
            }
            
            .nav-links {
                gap: 1rem;
                font-size: 0.9rem;
            }
            
            .main-container {
                margin-top: 70px;
            }
            
            .search-section, .content-area {
                padding: 1rem;
                margin: 1rem;
            }
            
            .sidebar {
                padding: 1rem;
                margin: 1rem;
            }
            
            .music-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1rem;
            }
            
            .album-cover {
                height: 150px;
            }
            
            .modal-content {
                flex-direction: column;
                width: 95%;
            }
            
            .album-art {
                width: 200px;
                height: 200px;
                margin: 1rem auto;
            }
            
            .album-info {
                padding: 1rem;
            }
            
            .player {
                padding: 0.5rem 1rem;
            }
            
            .now-playing {
                width: 200px;
            }
            
            .now-playing-cover {
                width: 40px;
                height: 40px;
            }
        }

        @media (max-width: 480px) {
            .nav-links a:not(.logo) span {
                display: none;
            }
            
            .nav-links a:not(.logo)::before {
                content: attr(data-icon);
            }
            
            .music-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
            
            .card-content {
                padding: 1rem;
            }
            
            .card-title {
                font-size: 1rem;
            }
            
            .card-artist {
                font-size: 0.8rem;
            }
            
            .player {
                flex-direction: column;
                padding: 0.5rem;
            }
            
            .now-playing, .player-controls, .volume-controls {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            
            .volume-controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav>
        <a href="index.html" class="logo">ä¸œæ–¹åŒéŸ³</a>
        <div class="nav-links">
            <a href="index.html">é¦–é¡µ</a>
            <a href="music.html" class="active">éŸ³ä¹åº“</a>
            <a href="#">è‰ºæœ¯å®¶</a>
            <a href="#">å…³äºæˆ‘ä»¬</a>
        </div>
    </nav>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-container">
        <!-- å·¦ä¾§ç­›é€‰é¢æ¿ -->
        <aside class="sidebar">
            <div class="filter-group">
                <h3>æŒ‰ç¤¾å›¢ç­›é€‰</h3>
                <div class="filter-options">
                    <div class="filter-option">
                        <input type="checkbox" id="org1">
                        <label for="org1">ä¸Šæµ·çˆ±ä¸½ä¸å¹»ä¹å›¢</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="org2">
                        <label for="org2">é»„æ˜è¾¹å¢ƒ</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="org3">
                        <label for="org3">Alstroemeria Records</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="org4">
                        <label for="org4">å¹½é—­æ˜Ÿå…‰</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="org5">
                        <label for="org5">A-One</label>
                    </div>
                </div>
            </div>
            
            <div class="filter-group">
                <h3>æŒ‰é£æ ¼ç­›é€‰</h3>
                <div class="filter-options">
                    <div class="filter-option">
                        <input type="checkbox" id="genre1">
                        <label for="genre1">æ‘‡æ»š</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="genre2">
                        <label for="genre2">ç”µå­</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="genre3">
                        <label for="genre3">å¤å…¸</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="genre4">
                        <label for="genre4">çˆµå£«</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="genre5">
                        <label for="genre5">æ°‘æ—</label>
                    </div>
                </div>
            </div>
            
            <div class="filter-group">
                <h3>æŒ‰è§’è‰²ç­›é€‰</h3>
                <div class="filter-options">
                    <div class="filter-option">
                        <input type="checkbox" id="char1">
                        <label for="char1">åšä¸½çµæ¢¦</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="char2">
                        <label for="char2">é›¾é›¨é­”ç†æ²™</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="char3">
                        <label for="char3">åå…­å¤œå’²å¤œ</label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="char4">
                        <label for="char4">è•¾ç±³è‰äºšÂ·æ–¯å¡é›·ç‰¹</label>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- ä¸­å¤®å†…å®¹åŒºåŸŸ -->
        <main class="content-area">
            <div class="search-section">
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="æœç´¢éŸ³ä¹ã€è‰ºæœ¯å®¶ã€ä¸“è¾‘...">
                    <button class="search-button"><i class="fas fa-search"></i></button>
                </div>
                
                <div class="filter-tags">
                    <div class="tag active">å…¨éƒ¨</div>
                    <div class="tag">æœ€æ–°</div>
                    <div class="tag">çƒ­é—¨</div>
                    <div class="tag">æ‘‡æ»š</div>
                    <div class="tag">ç”µå­</div>
                    <div class="tag">å¤å…¸</div>
                </div>
            </div>
            
            <div class="section-title">
                <h2>éŸ³ä¹åº“</h2>
                <div class="sort-options">
                    <button class="sort-btn active">æœ€æ–°</button>
                    <button class="sort-btn">çƒ­é—¨</button>
                    <button class="sort-btn">è¯„åˆ†</button>
                </div>
            </div>
            
            <div class="music-grid">
            </div>
            
            <div class="pagination">
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">3</button>
                <button class="page-btn">...</button>
                <button class="page-btn">10</button>
                <button class="page-btn"><i class="fas fa-chevron-right"></i></button>
            </div>
        </main>
    </div>
    
    <!-- ä¸“è¾‘è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="albumModal">
        <button class="close-modal" onclick="closeAlbumModal()"><i class="fas fa-times"></i></button>
        <div class="modal-content">
            <div class="album-art">ğŸµ</div>
            <div class="album-info">
                <h2 class="album-title">ä¸œæ–¹çº¢é­”ä¹¡</h2>
                <p class="album-artist">ä¸Šæµ·çˆ±ä¸½ä¸å¹»ä¹å›¢</p>
                <div class="album-meta">
                    <span>2002å¹´</span>
                    <span>â€¢</span>
                    <span>15é¦–æ›²ç›®</span>
                    <span>â€¢</span>
                    <span>ä¸“è¾‘</span>
                </div>
                <p class="album-description">ã€Šä¸œæ–¹çº¢é­”ä¹¡ ï½ the Embodiment of Scarlet Devil.ã€‹æ˜¯ä¸œæ–¹Projectç³»åˆ—çš„ç¬¬å…­ä¸ªä½œå“ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªå‘å¸ƒåœ¨Windowså¹³å°ä¸Šçš„ä½œå“ã€‚è¯¥ä½œå“å¥ å®šäº†ä¸œæ–¹Projectåœ¨åŒäººéŸ³ä¹ç•Œçš„åœ°ä½ã€‚</p>
                
                <div class="track-list">
                    <h3>æ›²ç›®åˆ—è¡¨</h3>
                    <ul class="tracks">
                        <li class="track">
                            <button class="track-play-btn"><i class="fas fa-play"></i></button>
                            <span class="track-number">01</span>
                            <span class="track-title">åºæ›²</span>
                            <span class="track-duration">1:28</span>
                        </li>
                        <li class="track">
                            <button class="track-play-btn"><i class="fas fa-play"></i></button>
                            <span class="track-number">02</span>
                            <span class="track-title">æ¢¦æœˆä»™å¢ƒ</span>
                            <span class="track-duration">3:45</span>
                        </li>
                        <li class="track">
                            <button class="track-play-btn"><i class="fas fa-play"></i></button>
                            <span class="track-number">03</span>
                            <span class="track-title">å¹»è§†ä¹‹å¤œ</span>
                            <span class="track-duration">4:12</span>
                        </li>
                        <li class="track">
                            <button class="track-play-btn"><i class="fas fa-play"></i></button>
                            <span class="track-number">04</span>
                            <span class="track-title">è‹ç©ºä¹‹é•œ</span>
                            <span class="track-duration">5:23</span>
                        </li>
                        <li class="track">
                            <button class="track-play-btn"><i class="fas fa-play"></i></button>
                            <span class="track-number">05</span>
                            <span class="track-title">è¢«å°å°çš„å¦–æ€ª</span>
                            <span class="track-duration">3:56</span>
                        </li>
                        <li class="track">
                            <button class="track-play-btn"><i class="fas fa-play"></i></button>
                            <span class="track-number">06</span>
                            <span class="track-title">çº¢é›¾ä¹‹æ‹</span>
                            <span class="track-duration">4:33</span>
                        </li>
                        <li class="track">
                            <button class="track-play-btn"><i class="fas fa-play"></i></button>
                            <span class="track-number">07</span>
                            <span class="track-title">é­”æ³•å°‘å¥³ä»¬çš„ç››å®´</span>
                            <span class="track-duration">6:01</span>
                        </li>
                        <li class="track">
                            <button class="track-play-btn"><i class="fas fa-play"></i></button>
                            <span class="track-number">08</span>
                            <span class="track-title">çº¢é­”ä¹¡</span>
                            <span class="track-duration">7:18</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- åº•éƒ¨éŸ³ä¹æ’­æ”¾å™¨ -->
    <div class="player">
        <div class="now-playing">
            <div class="now-playing-cover">ğŸµ</div>
            <div class="now-playing-info">
                <div class="now-playing-title">æ¢¦æœˆä»™å¢ƒ</div>
                <div class="now-playing-artist">ä¸Šæµ·çˆ±ä¸½ä¸å¹»ä¹å›¢</div>
            </div>
        </div>
        
        <div class="player-controls">
            <div class="control-buttons">
                <button class="control-btn"><i class="fas fa-random"></i></button>
                <button class="control-btn"><i class="fas fa-step-backward"></i></button>
                <button class="control-btn play-pause"><i class="fas fa-play"></i></button>
                <button class="control-btn"><i class="fas fa-step-forward"></i></button>
                <button class="control-btn"><i class="fas fa-redo"></i></button>
            </div>
            
            <div class="progress-container">
                <span class="progress-time">1:20</span>
                <div class="progress-bar">
                    <div class="progress"></div>
                </div>
                <span class="progress-time">4:45</span>
            </div>
        </div>
        
        <div class="volume-controls">
            <i class="fas fa-volume-up volume-icon"></i>
            <div class="volume-slider">
                <div class="volume-level"></div>
            </div>
        </div>
    </div>
    
    <!-- éšè—çš„éŸ³é¢‘æ’­æ”¾å™¨ -->
    <audio id="audioPlayer" style="display: none;"></audio>
    
    <!-- ç‰ˆæœ¬å·æ˜¾ç¤º -->
    <div id="version-info" style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; z-index: 1002;">
        ç‰ˆæœ¬: v1.0.1
    </div>
    <script>
        // æ‰“å¼€ä¸“è¾‘è¯¦æƒ…æ¨¡æ€æ¡†
        function openAlbumModal() {
            document.getElementById('albumModal').style.display = 'flex';
        }
        
        // å…³é—­ä¸“è¾‘è¯¦æƒ…æ¨¡æ€æ¡†
        function closeAlbumModal() {
            document.getElementById('albumModal').style.display = 'none';
        }
        
        // æ›´æ–°ä¸“è¾‘è¯¦æƒ…æ¨¡æ€æ¡†å†…å®¹
        async function updateAlbumModal(albumId) {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showLoadingState();
                
                // è°ƒç”¨åç«¯æ¥å£è·å–ä¸“è¾‘è¯¦æƒ…
                const response = await fetch(`/api/music/detail?albumId=${albumId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const albumDetail = await response.json();
                
                // æ›´æ–°æ ‡é¢˜
                document.querySelector('.album-title').textContent = albumDetail.title || 'æœªçŸ¥ä¸“è¾‘';
                
                // æ›´æ–°è‰ºæœ¯å®¶
                document.querySelector('.album-artist').textContent = albumDetail.artist || 'æœªçŸ¥è‰ºæœ¯å®¶';
                
                // æ›´æ–°å…ƒä¿¡æ¯
                const metaElements = document.querySelectorAll('.album-meta span');
                if (metaElements.length >= 3) {
                    const publishDate = albumDetail.publishDate ? new Date(albumDetail.publishDate) : null;
                    metaElements[0].textContent = publishDate ? publishDate.getFullYear() + 'å¹´' : 'æœªçŸ¥';
                    metaElements[2].textContent = albumDetail.tracks && albumDetail.tracks.length > 0 ? 
                        `${albumDetail.tracks.length}é¦–æ›²ç›®` : '10é¦–æ›²ç›®';
                }
                
                // æ›´æ–°æè¿°
                const descriptionElement = document.querySelector('.album-description');
                if (descriptionElement) {
                    descriptionElement.textContent = albumDetail.description || 'æš‚æ— ä¸“è¾‘æè¿°';
                }
                
                // æ›´æ–°ä¸“è¾‘å°é¢ - ä½¿ç”¨æœ¬åœ°ç¼“å­˜å’Œç¼©ç•¥å›¾ä¼˜åŒ–

                const albumArtElement = document.querySelector('.album-art');

                if (albumArtElement) {

                    if (albumDetail.cloudMusicPicUrl) {

                        // ä½¿ç”¨ç¼“å­˜æœºåˆ¶åŠ è½½å›¾ç‰‡

                        loadImageWithCache(albumArtElement, albumDetail.cloudMusicPicUrl, 300, 300);

                    } else {

                        // å¦‚æœæ²¡æœ‰å°é¢å›¾ç‰‡ï¼Œæ˜¾ç¤ºé»˜è®¤å›¾æ ‡

                        if (!albumArtElement.querySelector('.fallback-content')) {

                            albumArtElement.innerHTML = '<div class="fallback-content">ğŸµ</div>';

                        }

                    }

                }
                
                // æ›´æ–°æ›²ç›®åˆ—è¡¨

                const tracksContainer = document.querySelector('.tracks');

                if (tracksContainer) {

                    let tracksHtml = '';

                    

                    if (albumDetail.tracks && albumDetail.tracks.length > 0) {

                        // ä½¿ç”¨çœŸå®çš„æ›²ç›®åˆ—è¡¨

                        albumDetail.tracks.forEach((track, index) => {

                            const trackNumber = (index + 1).toString().padStart(2, '0');

                            const duration = track.duration || '0:00';

                            const trackTitle = track.name || `æ›²ç›® ${index + 1}`;

                            

                            // æ£€æŸ¥æ˜¯å¦æœ‰éŸ³ä¹URLï¼Œå¦‚æœæ²¡æœ‰åˆ™æ˜¾ç¤ºæ— æ³•æ’­æ”¾çš„æç¤º

                            const hasMusicUrl = track.url || track.mp3Url || track.musicUrl || track.fileUrl || track.cloudMusicUrl;

                            

                            if (hasMusicUrl) {

                                tracksHtml += `

                                    <li class="track">

                                        <button class="track-play-btn"><i class="fas fa-play"></i></button>

                                        <span class="track-number">${trackNumber}</span>

                                        <span class="track-title">${trackTitle}</span>

                                        <span class="track-duration">${duration}</span>

                                    </li>

                                `;

                            } else {

                                tracksHtml += `

                                    <li class="track">

                                        <button class="track-play-btn" disabled style="opacity: 0.5; cursor: not-allowed;"><i class="fas fa-play"></i></button>

                                        <span class="track-number">${trackNumber}</span>

                                        <span class="track-title">${trackTitle} <span style="color: #999; font-size: 0.8em;">(æ— æ³•æ’­æ”¾)</span></span>

                                        <span class="track-duration">${duration}</span>

                                    </li>

                                `;

                            }

                        });

                    } else {

                        // å¦‚æœæ²¡æœ‰æ›²ç›®æ•°æ®ï¼Œæ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®

                        const trackCount = 10;

                        const title = albumDetail.title || 'æœªçŸ¥ä¸“è¾‘';

                        for (let i = 1; i <= trackCount; i++) {

                            tracksHtml += `

                                <li class="track">

                                    <button class="track-play-btn"><i class="fas fa-play"></i></button>

                                    <span class="track-number">${i.toString().padStart(2, '0')}</span>

                                    <span class="track-title">${title} - æ›²ç›® ${i}</span>

                                    <span class="track-duration">${Math.floor(Math.random() * 4 + 2)}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}</span>

                                </li>

                            `;

                        }

                    }

                    

                    tracksContainer.innerHTML = tracksHtml;

                }
                
                // éšè—åŠ è½½çŠ¶æ€
                hideLoadingState();
                
                // é‡æ–°ç»‘å®šæ’­æ”¾æŒ‰é’®äº‹ä»¶

                document.querySelectorAll('.track-play-btn').forEach(button => {

                    button.addEventListener('click', function(e) {

                        e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡

                        

                        // å¦‚æœæŒ‰é’®è¢«ç¦ç”¨ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ

                        if (this.disabled) {

                            return;

                        }

                        

                        const icon = this.querySelector('i');

                        if (icon.classList.contains('fa-play')) {

                            // æ’­æ”¾å½“å‰æ›²ç›®

                            icon.classList.remove('fa-play');

                            icon.classList.add('fa-pause');

                            

                            // è·å–å½“å‰æ›²ç›®ç´¢å¼•

                            const track = this.closest('.track');

                            if (track) {

                                const trackIndex = Array.from(track.parentNode.children).indexOf(track);

                                const albumArt = document.querySelector('.album-art').closest('.modal').querySelector('.album-art').parentNode;

                                const albumId = albumArt.getAttribute('data-album-id');

                                

                                // è·å–ä¸“è¾‘è¯¦æƒ…å¹¶æ’­æ”¾æŒ‡å®šæ›²ç›®

                                if (albumId) {

                                    fetch(`/api/music/detail?albumId=${albumId}`)

                                        .then(response => response.json())

                                        .then(albumDetail => {

                                            playMusic(albumDetail, trackIndex); // æ’­æ”¾æŒ‡å®šæ›²ç›®

                                        })

                                        .catch(error => {

                                            console.error('è·å–ä¸“è¾‘è¯¦æƒ…å¤±è´¥:', error);

                                        });

                                }

                            }

                        } else {

                            icon.classList.remove('fa-pause');

                            icon.classList.add('fa-play');

                            pauseMusic();

                        }

                    });

                });
                
            } catch (error) {
                console.error('è·å–ä¸“è¾‘è¯¦æƒ…å¤±è´¥:', error);
                
                // éšè—åŠ è½½çŠ¶æ€
                hideLoadingState();
                
                // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
                showErrorState('åŠ è½½ä¸“è¾‘è¯¦æƒ…å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoadingState() {
            const albumTitle = document.querySelector('.album-title');
            const albumArtElement = document.querySelector('.album-art');
            const tracksContainer = document.querySelector('.tracks');
            
            if (albumTitle) {
                albumTitle.textContent = 'åŠ è½½ä¸­...';
            }
            
            if (albumArtElement) {
                const fallbackContent = albumArtElement.querySelector('.fallback-content');
                if (fallbackContent) {
                    fallbackContent.textContent = 'åŠ è½½ä¸­...';
                } else {
                    albumArtElement.innerHTML = '<div class="fallback-content">åŠ è½½ä¸­...</div>';
                }
            }
            
            if (tracksContainer) {
                tracksContainer.innerHTML = '<li class="track"><span class="track-title">æ­£åœ¨åŠ è½½æ›²ç›®åˆ—è¡¨...</span></li>';
            }
        }
        
        // éšè—åŠ è½½çŠ¶æ€
        function hideLoadingState() {
            // è¿™ä¸ªå‡½æ•°ä¼šç”±æ•°æ®æ›´æ–°æ—¶è‡ªåŠ¨å¤„ç†
        }
        
        // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
        function showErrorState(message) {
            // å…³é—­æ¨¡æ€æ¡†ï¼ˆå¦‚æœéœ€è¦ï¼‰
            const modal = document.getElementById('albumModal');
            if (modal) {
                modal.style.display = 'none';
            }
            
            // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
            alert(message);
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('albumModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–éŸ³ä¹æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ—¶åŠ è½½æ‰€æœ‰éŸ³ä¹æ•°æ®
            searchMusic('');
        });
        
        // æœç´¢åŠŸèƒ½
        document.querySelector('.search-button').addEventListener('click', function() {
            const searchTerm = document.querySelector('.search-input').value;
            if (searchTerm.trim() !== '') {
                searchMusic(searchTerm);
            }
        });
        
        // éŸ³ä¹æœç´¢å‡½æ•°
        function searchMusic(keyword, page = 1) {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const musicGrid = document.querySelector('.music-grid');
            musicGrid.innerHTML = '<div class="loading">æœç´¢ä¸­...</div>';
            
            // æ„å»ºæŸ¥è¯¢å‚æ•°
            const params = new URLSearchParams();
            params.append('keyword', keyword);
            params.append('pageNumber', page.toString());
            params.append('pageSize', '16');
            
            // å‘é€è¯·æ±‚åˆ°åç«¯API
            fetch(`/api/music/search?${params.toString()}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // æ¸²æŸ“æœç´¢ç»“æœ
                    renderSearchResults(data);
                    // æ¸²æŸ“åˆ†é¡µæ§ä»¶
                    renderPagination(data, keyword);
                })
                .catch(error => {
                    console.error('æœç´¢å‡ºé”™:', error);
                    musicGrid.innerHTML = '<div class="error">æœç´¢å‡ºé”™ï¼Œè¯·ç¨åé‡è¯•</div>';
                });
        }
        
        // æ¸²æŸ“æœç´¢ç»“æœ
        function renderSearchResults(data) {
            const musicGrid = document.querySelector('.music-grid');
            
            if (!data.records || data.records.length === 0) {
                musicGrid.innerHTML = '<div class="no-results">æœªæ‰¾åˆ°ç›¸å…³éŸ³ä¹</div>';
                return;
            }
            
            let html = '';

            data.records.forEach((music, index) => {

                html += `

                <div class="music-card" data-index="${index}" data-title="${music.title || 'æœªçŸ¥ä¸“è¾‘'}" data-description="${music.description || 'æš‚æ— æè¿°'}" data-access-count="${music.accessCount || 0}" data-cover-url="${music.cloudMusicPicUrl || ''}" data-album-id="${music.id || ''}">

                    <div class="album-cover" data-original-url="${music.cloudMusicPicUrl || ''}">

                        ${music.cloudMusicPicUrl ? '' : '<div class="fallback-content">ğŸµ</div>'}

                    </div>

                    <div class="card-content">

                        <h3 class="card-title">${music.title || 'æœªçŸ¥ä¸“è¾‘'}</h3>

                        <div class="card-stats">

                            <span><i class="far fa-heart"></i> ${music.accessCount || 0}</span>

                        </div>

                    </div>

                    <button class="play-button"><i class="fas fa-play"></i></button>

                </div>

                `;

            });
            
            musicGrid.innerHTML = html;
            
            // é‡æ–°ç»‘å®šæ’­æ”¾æŒ‰é’®äº‹ä»¶

            document.querySelectorAll('.play-button').forEach(button => {

                button.addEventListener('click', function(e) {

                    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è§¦å‘å¡ç‰‡ç‚¹å‡»äº‹ä»¶

                    

                    const icon = this.querySelector('i');

                    if (icon.classList.contains('fa-play')) {

                        // æ’­æ”¾ä¸“è¾‘ç¬¬ä¸€é¦–éŸ³ä¹

                        icon.classList.remove('fa-play');

                        icon.classList.add('fa-pause');

                        

                        // è·å–ä¸“è¾‘ä¿¡æ¯å¹¶æ’­æ”¾

                        const card = this.closest('.music-card');

                        if (card) {

                            const albumId = card.getAttribute('data-album-id');

                            if (albumId) {

                                // è·å–ä¸“è¾‘è¯¦æƒ…å¹¶æ’­æ”¾

                                fetch(`/api/music/detail?albumId=${albumId}`)

                                    .then(response => response.json())

                                    .then(albumDetail => {

                                        playMusic(albumDetail, 0); // æ’­æ”¾ä¸“è¾‘ç¬¬ä¸€é¦–

                                    })

                                    .catch(error => {

                                        console.error('è·å–ä¸“è¾‘è¯¦æƒ…å¤±è´¥:', error);

                                        // æ¢å¤æŒ‰é’®çŠ¶æ€

                                        icon.classList.remove('fa-pause');

                                        icon.classList.add('fa-play');

                                    });

                            }

                        }

                    } else {

                        icon.classList.remove('fa-pause');

                        icon.classList.add('fa-play');

                        pauseMusic();

                    }

                });

            });
            
            // ä¸ºéŸ³ä¹å¡ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œæ‰“å¼€æ¨¡æ€æ¡†
            document.querySelectorAll('.music-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    // å¦‚æœç‚¹å‡»çš„æ˜¯æ’­æ”¾æŒ‰é’®ï¼Œåˆ™ä¸æ‰“å¼€æ¨¡æ€æ¡†
                    if (e.target.closest('.play-button')) {
                        return;
                    }
                    
                    // è·å–ä¸“è¾‘ä¿¡æ¯
                    const albumId = this.getAttribute('data-album-id');
                    
                    if (albumId) {
                        // æ›´æ–°æ¨¡æ€æ¡†å†…å®¹
                        updateAlbumModal(albumId);
                        
                        // æ‰“å¼€æ¨¡æ€æ¡†
                        openAlbumModal();
                    } else {
                        console.error('æœªæ‰¾åˆ°ä¸“è¾‘ID');
                    }
                });
            });
        }
        
        // æ¸²æŸ“åˆ†é¡µæ§ä»¶
        function renderPagination(data, keyword) {
            const paginationContainer = document.querySelector('.pagination');
            if (!paginationContainer) return;
            
            let paginationHtml = '';
            
            // ä¸Šä¸€é¡µæŒ‰é’®
            if (data.current > 1) {
                paginationHtml += `<button class="page-btn" data-page="${data.current - 1}" data-keyword="${keyword}">â€¹</button>`;
            }
            
            // é¡µç æŒ‰é’®
            const startPage = Math.max(1, data.current - 2);
            const endPage = Math.min(data.pages, data.current + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                if (i === data.current) {
                    paginationHtml += `<button class="page-btn active" data-page="${i}" data-keyword="${keyword}">${i}</button>`;
                } else {
                    paginationHtml += `<button class="page-btn" data-page="${i}" data-keyword="${keyword}">${i}</button>`;
                }
            }
            
            // ä¸‹ä¸€é¡µæŒ‰é’®
            if (data.current < data.pages) {
                paginationHtml += `<button class="page-btn" data-page="${data.current + 1}" data-keyword="${keyword}">â€º</button>`;
            }
            
            paginationContainer.innerHTML = paginationHtml;
            
            // é‡æ–°ç»‘å®šåˆ†é¡µæŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.page-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    const keyword = this.getAttribute('data-keyword');
                    searchMusic(keyword, page);
                });
            });
        }
        
        // å›è½¦æœç´¢
        document.querySelector('.search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.querySelector('.search-button').click();
            }
        });
        
        // æ ‡ç­¾åˆ‡æ¢
        const tags = document.querySelectorAll('.tag');
        tags.forEach(tag => {
            tag.addEventListener('click', function() {
                tags.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // æ’åºæŒ‰é’®åˆ‡æ¢
        const sortBtns = document.querySelectorAll('.sort-btn');
        sortBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                sortBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // åˆ†é¡µæŒ‰é’®åˆ‡æ¢
        const pageBtns = document.querySelectorAll('.page-btn');
        pageBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                if (!this.textContent.includes('...')) {
                    pageBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });
        
        // æ’­æ”¾å™¨å˜é‡
        const audioPlayer = document.getElementById('audioPlayer');
        let currentTrackIndex = 0; // å½“å‰æ’­æ”¾çš„æ›²ç›®ç´¢å¼•
        let isPlaying = false; // æ’­æ”¾çŠ¶æ€
        let currentMusicData = null; // å½“å‰æ’­æ”¾çš„éŸ³ä¹æ•°æ®

        // æ’­æ”¾éŸ³ä¹å‡½æ•°
        function playMusic(musicData, trackIndex = 0) {
            // å¦‚æœä¼ å…¥äº†éŸ³ä¹æ•°æ®ï¼Œæ›´æ–°å½“å‰éŸ³ä¹æ•°æ®
            if (musicData) {
                currentMusicData = musicData;
                currentTrackIndex = trackIndex;
            }

            // å¦‚æœæ²¡æœ‰å½“å‰éŸ³ä¹æ•°æ®ï¼Œæ— æ³•æ’­æ”¾
            if (!currentMusicData) {
                console.error('æ²¡æœ‰å¯æ’­æ”¾çš„éŸ³ä¹æ•°æ®');
                return;
            }

            // è·å–å½“å‰æ›²ç›®çš„ä¿¡æ¯

            let trackTitle, trackArtist, trackId;

            if (currentMusicData.tracks && currentMusicData.tracks.length > 0 && currentTrackIndex < currentMusicData.tracks.length) {

                const currentTrack = currentMusicData.tracks[currentTrackIndex];

                trackTitle = currentTrack.name || `æ›²ç›® ${currentTrackIndex + 1}`;

                trackArtist = currentMusicData.artist || 'æœªçŸ¥è‰ºæœ¯å®¶';

                // è·å–ç½‘æ˜“äº‘éŸ³ä¹IDç”¨äºè°ƒç”¨API

                trackId = currentTrack.id;

            } else {

                // å¦‚æœæ²¡æœ‰æ›²ç›®æ•°æ®ï¼Œä½¿ç”¨ä¸“è¾‘ä¿¡æ¯

                trackTitle = currentMusicData.title || 'æœªçŸ¥éŸ³ä¹';

                trackArtist = currentMusicData.artist || 'æœªçŸ¥è‰ºæœ¯å®¶';

                trackId = undefined;

            }

            // å¦‚æœæœ‰trackIdï¼Œå…ˆè°ƒç”¨APIè·å–URL

            if (trackId) {

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€

                document.querySelector('.now-playing-title').textContent = trackTitle + ' (åŠ è½½ä¸­...)';

                

                fetch(`/api/music/track?id=${trackId}`)

                    .then(response => response.json())

                    .then(data => {

                        // ä»APIå“åº”ä¸­æå–éŸ³ä¹URL

                        let trackUrl = '';

                        if (data && data.url) {

                            trackUrl = data.url;

                        }



                        // è®¾ç½®éŸ³é¢‘æºå¹¶æ’­æ”¾

                        audioPlayer.src = trackUrl;

                        audioPlayer.play().then(() => {

                            isPlaying = true;

                            // æ›´æ–°æ’­æ”¾å™¨UI

                            updatePlayerUI(trackTitle, trackArtist, true);

                            // æ›´æ–°æ’­æ”¾æŒ‰é’®å›¾æ ‡

                            document.querySelectorAll('.play-button, .track-play-btn, .control-btn.play-pause').forEach(btn => {

                                const icon = btn.querySelector('i');

                                if (icon) {

                                    icon.classList.remove('fa-play');

                                    icon.classList.add('fa-pause');

                                }

                            });

                        }).catch(error => {

                            console.error('æ’­æ”¾å¤±è´¥:', error);

                            // å¦‚æœé€šè¿‡APIè·å–çš„URLæ— æ³•æ’­æ”¾ï¼Œä¹Ÿå°è¯•å›é€€åˆ°åŸå§‹URL

                            if (currentMusicData.tracks && currentMusicData.tracks.length > 0 && currentTrackIndex < currentMusicData.tracks.length) {

                                const currentTrack = currentMusicData.tracks[currentTrackIndex];

                                const fallbackUrl = currentTrack.cloudMusicUrl || currentTrack.url || currentTrack.mp3Url || currentTrack.musicUrl || currentTrack.fileUrl || `http://example.com/music/${currentMusicData.id}/${currentTrackIndex + 1}.mp3`;

                                audioPlayer.src = fallbackUrl;

                                audioPlayer.play().then(() => {

                                    isPlaying = true;

                                    updatePlayerUI(trackTitle, trackArtist, true);

                                    document.querySelectorAll('.play-button, .track-play-btn, .control-btn.play-pause').forEach(btn => {

                                        const icon = btn.querySelector('i');

                                        if (icon) {

                                            icon.classList.remove('fa-play');

                                            icon.classList.add('fa-pause');

                                        }

                                    });

                                }).catch(fallbackError => {

                                    console.error('å›é€€æ’­æ”¾ä¹Ÿå¤±è´¥:', fallbackError);

                                    // æ¢å¤æ’­æ”¾æŒ‰é’®çŠ¶æ€

                                    document.querySelectorAll('.play-button, .track-play-btn, .control-btn.play-pause').forEach(btn => {

                                        const icon = btn.querySelector('i');

                                        if (icon) {

                                            icon.classList.remove('fa-pause');

                                            icon.classList.add('fa-play');

                                        }

                                    });

                                });

                            } else {

                                // æ¢å¤æ’­æ”¾æŒ‰é’®çŠ¶æ€

                                document.querySelectorAll('.play-button, .track-play-btn, .control-btn.play-pause').forEach(btn => {

                                    const icon = btn.querySelector('i');

                                    if (icon) {

                                        icon.classList.remove('fa-pause');

                                        icon.classList.add('fa-play');

                                    }

                                });

                            }

                        });

                    })

                    .catch(error => {

                        console.error('è·å–éŸ³ä¹URLå¤±è´¥:', error);

                        // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨å›é€€URL

                        let fallbackUrl = '';

                        if (currentMusicData.tracks && currentMusicData.tracks.length > 0 && currentTrackIndex < currentMusicData.tracks.length) {

                            const currentTrack = currentMusicData.tracks[currentTrackIndex];

                            fallbackUrl = currentTrack.cloudMusicUrl || currentTrack.url || currentTrack.mp3Url || currentTrack.musicUrl || currentTrack.fileUrl || `http://example.com/music/${currentMusicData.id}/${currentTrackIndex + 1}.mp3`;

                        } else {

                            fallbackUrl = currentMusicData.cloudMusicUrl || currentMusicData.url || currentMusicData.mp3Url || currentMusicData.musicUrl || currentMusicData.fileUrl || `http://example.com/music/${currentMusicData.id}.mp3`;

                        }



                        audioPlayer.src = fallbackUrl;

                        audioPlayer.play().then(() => {

                            isPlaying = true;

                            updatePlayerUI(trackTitle, trackArtist, true);

                            document.querySelectorAll('.play-button, .track-play-btn, .control-btn.play-pause').forEach(btn => {

                                const icon = btn.querySelector('i');

                                if (icon) {

                                    icon.classList.remove('fa-play');

                                    icon.classList.add('fa-pause');

                                }

                            });

                        }).catch(fallbackError => {

                            console.error('å›é€€æ’­æ”¾ä¹Ÿå¤±è´¥:', fallbackError);

                            // æ¢å¤æ’­æ”¾æŒ‰é’®çŠ¶æ€

                            document.querySelectorAll('.play-button, .track-play-btn, .control-btn.play-pause').forEach(btn => {

                                const icon = btn.querySelector('i');

                                if (icon) {

                                    icon.classList.remove('fa-pause');

                                    icon.classList.add('fa-play');

                                }

                            });

                        });

                    });

            } else {

                // å¦‚æœæ²¡æœ‰trackIdï¼Œç›´æ¥ä½¿ç”¨åŸå§‹URL

                let trackUrl = '';

                if (currentMusicData.tracks && currentMusicData.tracks.length > 0 && currentTrackIndex < currentMusicData.tracks.length) {

                    const currentTrack = currentMusicData.tracks[currentTrackIndex];

                    trackUrl = currentTrack.cloudMusicUrl || currentTrack.url || currentTrack.mp3Url || currentTrack.musicUrl || currentTrack.fileUrl || `http://example.com/music/${currentMusicData.id}/${currentTrackIndex + 1}.mp3`;

                } else {

                    trackUrl = currentMusicData.cloudMusicUrl || currentMusicData.url || currentMusicData.mp3Url || currentMusicData.musicUrl || currentMusicData.fileUrl || `http://example.com/music/${currentMusicData.id}.mp3`;

                }



                // è®¾ç½®éŸ³é¢‘æºå¹¶æ’­æ”¾

                audioPlayer.src = trackUrl;

                audioPlayer.play().then(() => {

                    isPlaying = true;

                    // æ›´æ–°æ’­æ”¾å™¨UI

                    updatePlayerUI(trackTitle, trackArtist, true);

                    // æ›´æ–°æ’­æ”¾æŒ‰é’®å›¾æ ‡

                    document.querySelectorAll('.play-button, .track-play-btn, .control-btn.play-pause').forEach(btn => {

                        const icon = btn.querySelector('i');

                        if (icon) {

                            icon.classList.remove('fa-play');

                            icon.classList.add('fa-pause');

                        }

                    });

                }).catch(error => {

                    console.error('æ’­æ”¾å¤±è´¥:', error);

                    // æ¢å¤æ’­æ”¾æŒ‰é’®çŠ¶æ€

                    document.querySelectorAll('.play-button, .track-play-btn, .control-btn.play-pause').forEach(btn => {

                        const icon = btn.querySelector('i');

                        if (icon) {

                            icon.classList.remove('fa-pause');

                            icon.classList.add('fa-play');

                        }

                    });

                });

            }
        }

        // æš‚åœéŸ³ä¹
        function pauseMusic() {
            audioPlayer.pause();
            isPlaying = false;
            // æ›´æ–°æ’­æ”¾å™¨UI
            updatePlayerUI(null, null, false);
            // æ›´æ–°æ’­æ”¾æŒ‰é’®å›¾æ ‡
            document.querySelectorAll('.play-button, .track-play-btn, .control-btn.play-pause').forEach(btn => {
                const icon = btn.querySelector('i');
                if (icon) {
                    icon.classList.remove('fa-pause');
                    icon.classList.add('fa-play');
                }
            });
        }

        // æ›´æ–°æ’­æ”¾å™¨UI
        function updatePlayerUI(title, artist, playing) {
            if (title) {
                document.querySelector('.now-playing-title').textContent = title;
            }
            if (artist) {
                document.querySelector('.now-playing-artist').textContent = artist;
            }
            // æ˜¾ç¤ºæˆ–éšè—æ’­æ”¾å™¨
            document.querySelector('.player').style.display = playing ? 'flex' : 'none';
        }

        // æ’­æ”¾æŒ‰é’®åŠŸèƒ½
        const playButtons = document.querySelectorAll('.play-button, .track-play-btn, .control-btn.play-pause');
        playButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡
                
                const icon = this.querySelector('i');
                const isPlayIcon = icon.classList.contains('fa-play');

                // å¦‚æœæ˜¯ä¸“è¾‘å¡ç‰‡çš„æ’­æ”¾æŒ‰é’®
                if (this.classList.contains('play-button')) {
                    const card = this.closest('.music-card');
                    if (card) {
                        const albumId = card.getAttribute('data-album-id');
                        if (albumId) {
                            // è·å–ä¸“è¾‘è¯¦æƒ…å¹¶æ’­æ”¾
                            fetch(`/api/music/detail?albumId=${albumId}`)
                                .then(response => response.json())
                                .then(albumDetail => {
                                    if (isPlayIcon) {
                                        playMusic(albumDetail, 0); // æ’­æ”¾ä¸“è¾‘ç¬¬ä¸€é¦–
                                    } else {
                                        pauseMusic();
                                    }
                                })
                                .catch(error => {
                                    console.error('è·å–ä¸“è¾‘è¯¦æƒ…å¤±è´¥:', error);
                                });
                        }
                    }
                }
                // å¦‚æœæ˜¯æ›²ç›®åˆ—è¡¨çš„æ’­æ”¾æŒ‰é’®
                else if (this.classList.contains('track-play-btn')) {
                    const track = this.closest('.track');
                    const trackIndex = Array.from(track.parentNode.children).indexOf(track);
                    const albumId = document.querySelector('.album-title').closest('.modal').querySelector('.album-art').parentNode.getAttribute('data-album-id');
                    
                    if (albumId) {
                        // è·å–ä¸“è¾‘è¯¦æƒ…å¹¶æ’­æ”¾æŒ‡å®šæ›²ç›®
                        fetch(`/api/music/detail?albumId=${albumId}`)
                            .then(response => response.json())
                            .then(albumDetail => {
                                if (isPlayIcon) {
                                    playMusic(albumDetail, trackIndex);
                                } else {
                                    pauseMusic();
                                }
                            })
                            .catch(error => {
                                console.error('è·å–ä¸“è¾‘è¯¦æƒ…å¤±è´¥:', error);
                            });
                    }
                }
                // å¦‚æœæ˜¯æ’­æ”¾å™¨çš„æ’­æ”¾/æš‚åœæŒ‰é’®
                else if (this.classList.contains('control-btn') && this.classList.contains('play-pause')) {
                    if (isPlayIcon) {
                        // å¦‚æœå½“å‰æ²¡æœ‰éŸ³ä¹æ•°æ®ï¼Œå°è¯•æ’­æ”¾å½“å‰æ˜¾ç¤ºçš„éŸ³ä¹
                        if (!currentMusicData) {
                            const nowPlayingTitle = document.querySelector('.now-playing-title').textContent;
                            if (nowPlayingTitle && nowPlayingTitle !== 'æœªçŸ¥éŸ³ä¹') {
                                // è¿™é‡Œéœ€è¦æ ¹æ®å½“å‰æ’­æ”¾çš„éŸ³ä¹é‡æ–°è·å–æ•°æ®ï¼Œç®€åŒ–å¤„ç†
                                if (confirm('æ²¡æœ‰å½“å‰éŸ³ä¹æ•°æ®ï¼Œæ˜¯å¦é‡æ–°æ’­æ”¾å½“å‰éŸ³ä¹ï¼Ÿ')) {
                                    // æš‚æ—¶ä½¿ç”¨å½“å‰æ˜¾ç¤ºçš„æ ‡é¢˜è¿›è¡Œç¤ºä¾‹æ’­æ”¾
                                    const musicData = {
                                        title: nowPlayingTitle,
                                        artist: document.querySelector('.now-playing-artist').textContent,
                                        id: 'temp'
                                    };
                                    playMusic(musicData);
                                }
                            }
                        } else {
                            // ç»§ç»­æ’­æ”¾
                            audioPlayer.play().then(() => {
                                isPlaying = true;
                                updatePlayerUI(null, null, true);
                                icon.classList.remove('fa-play');
                                icon.classList.add('fa-pause');
                            }).catch(error => {
                                console.error('æ’­æ”¾å¤±è´¥:', error);
                            });
                        }
                    } else {
                        pauseMusic();
                    }
                }
            });
        });

        // ä¸Šä¸€é¦–æŒ‰é’®
        document.querySelector('.control-btn:nth-child(2)').addEventListener('click', function() {
            if (currentMusicData && currentMusicData.tracks && currentMusicData.tracks.length > 0) {
                // æ’­æ”¾ä¸Šä¸€é¦–
                currentTrackIndex = (currentTrackIndex - 1 + currentMusicData.tracks.length) % currentMusicData.tracks.length;
                playMusic(null, currentTrackIndex); // ä½¿ç”¨å½“å‰éŸ³ä¹æ•°æ®ï¼Œä½†åˆ‡æ¢æ›²ç›®
            }
        });

        // ä¸‹ä¸€é¦–æŒ‰é’®
        document.querySelector('.control-btn:nth-child(4)').addEventListener('click', function() {
            if (currentMusicData && currentMusicData.tracks && currentMusicData.tracks.length > 0) {
                // æ’­æ”¾ä¸‹ä¸€é¦–
                currentTrackIndex = (currentTrackIndex + 1) % currentMusicData.tracks.length;
                playMusic(null, currentTrackIndex); // ä½¿ç”¨å½“å‰éŸ³ä¹æ•°æ®ï¼Œä½†åˆ‡æ¢æ›²ç›®
            }
        });

        // è¿›åº¦æ¡æ§åˆ¶
        audioPlayer.addEventListener('timeupdate', function() {
            const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            document.querySelector('.progress').style.width = progress + '%';
            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            const currentTime = formatTime(audioPlayer.currentTime);
            const duration = formatTime(audioPlayer.duration);
            document.querySelectorAll('.progress-time')[0].textContent = currentTime;
            document.querySelectorAll('.progress-time')[1].textContent = duration;
        });

        // ç‚¹å‡»è¿›åº¦æ¡è·³è½¬
        document.querySelector('.progress-bar').addEventListener('click', function(e) {
            const rect = this.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            audioPlayer.currentTime = pos * audioPlayer.duration;
        });

        // éŸ³é‡æ§åˆ¶
        document.querySelector('.volume-slider').addEventListener('click', function(e) {
            const rect = this.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            audioPlayer.volume = pos;
            document.querySelector('.volume-level').style.width = pos * 100 + '%';
        });

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return min + ':' + sec.toString().padStart(2, '0');
        }

        // éŸ³é¢‘æ’­æ”¾ç»“æŸæ—¶è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€é¦–

        audioPlayer.addEventListener('ended', function() {

            if (currentMusicData && currentMusicData.tracks && currentMusicData.tracks.length > 0) {

                // è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€é¦–

                currentTrackIndex = (currentTrackIndex + 1) % currentMusicData.tracks.length;

                playMusic(null, currentTrackIndex); // ä½¿ç”¨å½“å‰éŸ³ä¹æ•°æ®ï¼Œä½†åˆ‡æ¢æ›²ç›®

            } else {

                // å¦‚æœåªæœ‰ä¸€é¦–æ­Œï¼Œæš‚åœæ’­æ”¾å™¨

                pauseMusic();

            }

        });



        // å›¾ç‰‡ç¼“å­˜å’Œç¼©ç•¥å›¾å¤„ç†

        const imageCache = new Map(); // å›¾ç‰‡ç¼“å­˜

        const pendingRequests = new Map(); // æ­£åœ¨åŠ è½½çš„å›¾ç‰‡è¯·æ±‚



        // ä½¿ç”¨ç¼“å­˜æœºåˆ¶åŠ è½½å›¾ç‰‡

        function loadImageWithCache(element, url, width, height) {

            // ç”Ÿæˆç¼“å­˜é”®

            const cacheKey = `${url}_${width}x${height}`;

            

            // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨ç¼“å­˜ä¸­

            if (imageCache.has(cacheKey)) {

                const cachedDataUrl = imageCache.get(cacheKey);

                element.style.backgroundImage = `url('${cachedDataUrl}')`;

                // ç§»é™¤ç°æœ‰çš„fallbackå†…å®¹

                const fallbackContent = element.querySelector('.fallback-content');

                if (fallbackContent) {

                    fallbackContent.remove();

                }

                return;

            }

            

            // æ£€æŸ¥æ˜¯å¦æ­£åœ¨åŠ è½½

            if (pendingRequests.has(cacheKey)) {

                // æ·»åŠ åˆ°å›è°ƒé˜Ÿåˆ—

                pendingRequests.get(cacheKey).push((dataUrl) => {

                    element.style.backgroundImage = `url('${dataUrl}')`;

                    // ç§»é™¤ç°æœ‰çš„fallbackå†…å®¹

                    const fallbackContent = element.querySelector('.fallback-content');

                    if (fallbackContent) {

                        fallbackContent.remove();

                    }

                });

                return;

            }

            

            // æ ‡è®°ä¸ºæ­£åœ¨åŠ è½½

            pendingRequests.set(cacheKey, []);

            

            // åˆ›å»ºå›¾ç‰‡å¯¹è±¡

            const img = new Image();

            img.crossOrigin = 'Anonymous';

            img.onload = function() {

                // åˆ›å»ºcanvasè¿›è¡Œç¼©ç•¥å›¾å¤„ç†

                const canvas = document.createElement('canvas');

                const ctx = canvas.getContext('2d');

                

                // è®¾ç½®canvaså°ºå¯¸

                canvas.width = width;

                canvas.height = height;

                

                // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ä»¥ä¿æŒå®½é«˜æ¯”

                const scale = Math.min(img.width, img.height) / Math.max(width, height);

                const newWidth = img.width * (width / Math.max(img.width, img.height));

                const newHeight = img.height * (height / Math.max(img.width, img.height));

                

                // åœ¨canvasä¸Šç»˜åˆ¶ç¼©ç•¥å›¾

                ctx.drawImage(

                    img, 

                    (width - newWidth) / 2, 

                    (height - newHeight) / 2, 

                    newWidth, 

                    newHeight

                );

                

                // è½¬æ¢ä¸ºdata URL

                const dataUrl = canvas.toDataURL('image/jpeg', 0.8);

                

                // ç¼“å­˜å¤„ç†åçš„å›¾ç‰‡

                imageCache.set(cacheKey, dataUrl);

                

                // åº”ç”¨åˆ°å…ƒç´ 

                element.style.backgroundImage = `url('${dataUrl}')`;

                // ç§»é™¤ç°æœ‰çš„fallbackå†…å®¹

                const fallbackContent = element.querySelector('.fallback-content');

                if (fallbackContent) {

                    fallbackContent.remove();

                }

                

                // æ‰§è¡Œå›è°ƒé˜Ÿåˆ—

                const callbacks = pendingRequests.get(cacheKey) || [];

                callbacks.forEach(callback => callback(dataUrl));

                

                // æ¸…é™¤è¯·æ±‚æ ‡è®°

                pendingRequests.delete(cacheKey);

            };

            

            img.onerror = function() {

                console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', url);

                // æ˜¾ç¤ºé»˜è®¤å›¾æ ‡

                if (!element.querySelector('.fallback-content')) {

                    element.innerHTML = '<div class="fallback-content">ğŸµ</div>';

                }

                

                // æ‰§è¡Œå›è°ƒé˜Ÿåˆ—

                const callbacks = pendingRequests.get(cacheKey) || [];

                callbacks.forEach(callback => callback(null));

                

                // æ¸…é™¤è¯·æ±‚æ ‡è®°

                pendingRequests.delete(cacheKey);

            };

            

            // å¼€å§‹åŠ è½½å›¾ç‰‡

            img.src = url;

        }



        // æ‡’åŠ è½½éŸ³ä¹å¡ç‰‡å°é¢å›¾ç‰‡

        function lazyLoadAlbumCovers() {

            const albumCovers = document.querySelectorAll('.album-cover[data-original-url]:not([data-loaded])');

            const options = {

                root: null,

                rootMargin: '0px',

                threshold: 0.1

            };

            

            const observer = new IntersectionObserver((entries, observer) => {

                entries.forEach(entry => {

                    if (entry.isIntersecting) {

                        const cover = entry.target;

                        const url = cover.getAttribute('data-original-url');

                        

                        if (url) {

                            // ä½¿ç”¨ç¼“å­˜æœºåˆ¶åŠ è½½å›¾ç‰‡

                            loadImageWithCache(cover, url, 200, 200);

                            cover.setAttribute('data-loaded', 'true');

                        }

                        

                        // åœæ­¢è§‚å¯Ÿå·²åŠ è½½çš„å…ƒç´ 

                        observer.unobserve(cover);

                    }

                });

            }, options);

            

            albumCovers.forEach(cover => {

                observer.observe(cover);

            });

        }



        // é¡µé¢æ»šåŠ¨æ—¶è§¦å‘æ‡’åŠ è½½

        let lazyLoadThrottleTimeout;

        window.addEventListener('scroll', () => {

            if (!lazyLoadThrottleTimeout) {

                lazyLoadThrottleTimeout = setTimeout(() => {

                    lazyLoadAlbumCovers();

                    lazyLoadThrottleTimeout = null;

                }, 20);

            }

        });



        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ‡’åŠ è½½

        document.addEventListener('DOMContentLoaded', function() {

            lazyLoadAlbumCovers();

        });



        // æ¯æ¬¡æœç´¢ç»“æœæ›´æ–°åè§¦å‘æ‡’åŠ è½½

        function triggerLazyLoadAfterSearch() {

            setTimeout(() => {

                lazyLoadAlbumCovers();

            }, 100);

        }



        // ä¿®æ”¹renderSearchResultså‡½æ•°ï¼Œåœ¨æœ€åæ·»åŠ æ‡’åŠ è½½è§¦å‘

        const originalRenderSearchResults = renderSearchResults;

        renderSearchResults = function(data) {

            originalRenderSearchResults(data);

            triggerLazyLoadAfterSearch();

        };

    </script>



</body>

</html>